const fs=require('fs');const path=require('path');const https=require('https');const OUT=path.join(__dirname,'..','src','data','research.pubmed.json');
function get(u){return new Promise((res,rej)=>https.get(u,(r)=>{let d='';r.on('data',c=>d+=c);r.on('end',()=>res(d));}).on('error',rej));}
(async()=>{try{const term=encodeURIComponent('alpha-gal syndrome');const es=`https://eutils.ncbi.nlm.nih.gov/entrez/eutils/esearch.fcgi?db=pubmed&retmode=json&sort=date&retmax=25&term=${term}`;const search=JSON.parse(await get(es));const ids=(search.esearchresult&&search.esearchresult.idlist)||[];const su=`https://eutils.ncbi.nlm.nih.gov/entrez/eutils/esummary.fcgi?db=pubmed&retmode=json&id=${ids.join(',')}`;const summary=JSON.parse(await get(su));fs.mkdirSync(path.dirname(OUT),{recursive:true});fs.writeFileSync(OUT,JSON.stringify({fetchedAt:new Date().toISOString(),ids,summary},null,2));console.log('Wrote',OUT);}catch(e){console.error(e);process.exit(1);}})();